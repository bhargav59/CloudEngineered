
======================================================================
  OpenRouter AI Integration Test Suite
======================================================================
Testing CloudEngineered AI functionality with OpenRouter

======================================================================
  1. Testing Configuration
======================================================================
‚úÖ OpenRouter API key configured: sk-or-v1-5a9959bd364...
‚úÖ USE_OPENROUTER is enabled
‚ÑπÔ∏è  AI_MOCK_MODE is disabled (using real API calls)

======================================================================
  2. Testing AI Models
======================================================================
‚ÑπÔ∏è  Total AI models in database: 8
‚ÑπÔ∏è  Active AI models: 8
‚úÖ AI models are configured

üìã Active Models:
   ‚Ä¢ claude-3-haiku (OpenRouter)
     Cost: $0.000250/1k input, $0.001250/1k output
   ‚Ä¢ claude-3.5-sonnet (OpenRouter)
     Cost: $0.003000/1k input, $0.015000/1k output
   ‚Ä¢ gemini-flash-1.5 (OpenRouter)
     Cost: $0.000075/1k input, $0.000300/1k output
   ‚Ä¢ gpt-4o (OpenRouter)
     Cost: $0.002500/1k input, $0.010000/1k output
   ‚Ä¢ gpt-4o-mini (OpenRouter)
     Cost: $0.000150/1k input, $0.000600/1k output
   ... and 3 more

======================================================================
  3. Testing OpenRouter Service
======================================================================
‚úÖ OpenRouter service initialized successfully
‚ÑπÔ∏è  Mock mode: False
‚ÑπÔ∏è  API key configured: Yes
‚ÑπÔ∏è  Site URL: https://cloudengineered.com
‚ÑπÔ∏è  App Name: CloudEngineered

======================================================================
  4. Testing Simple Content Generation
======================================================================
ERROR OpenRouter API error for model openai/gpt-4o-mini: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model openai/gpt-4o-mini failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
ERROR OpenRouter API error for model anthropic/claude-3-haiku: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model anthropic/claude-3-haiku failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
ERROR OpenRouter API error for model meta-llama/llama-3.1-8b-instruct: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model meta-llama/llama-3.1-8b-instruct failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
‚ùå Exception during generation: All fallback models failed. Last error: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
Traceback (most recent call last):
  File "/workspaces/CloudEngineered/apps/ai/openrouter_service.py", line 193, in generate_content
    return self._attempt_generation(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/CloudEngineered/apps/ai/openrouter_service.py", line 227, in _attempt_generation
    response = self.client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1147, in create
    return self._post(
           ^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.APIStatusError: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/workspaces/CloudEngineered/test_ai_integration.py", line 118, in test_simple_generation
    result = service.generate_content(
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/CloudEngineered/apps/ai/openrouter_service.py", line 207, in generate_content
    raise Exception(f"All fallback models failed. Last error: {str(e)}")
Exception: All fallback models failed. Last error: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}

======================================================================
  5. Testing Tool Review Generation
======================================================================
ERROR OpenRouter API error for model openai/gpt-4o-mini: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model openai/gpt-4o-mini failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
ERROR OpenRouter API error for model anthropic/claude-3-haiku: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model anthropic/claude-3-haiku failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
ERROR OpenRouter API error for model meta-llama/llama-3.1-8b-instruct: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model meta-llama/llama-3.1-8b-instruct failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
‚ùå Exception during generation: All fallback models failed. Last error: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}

======================================================================
  6. Testing Comparison Generation
======================================================================
ERROR OpenRouter API error for model openai/gpt-4o-mini: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model openai/gpt-4o-mini failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
ERROR OpenRouter API error for model anthropic/claude-3-haiku: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model anthropic/claude-3-haiku failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
ERROR OpenRouter API error for model meta-llama/llama-3.1-8b-instruct: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model meta-llama/llama-3.1-8b-instruct failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
‚ùå Exception during generation: All fallback models failed. Last error: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}

======================================================================
  7. Testing Different AI Models
======================================================================

üîÑ Testing GPT-4o Mini (Default)...
ERROR OpenRouter API error for model openai/gpt-4o-mini: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model openai/gpt-4o-mini failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
‚ùå GPT-4o Mini (Default): Exception - Failed to generate content with openai/gpt-4o-mini: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}

üîÑ Testing Llama 3.1 8B (Budget)...
ERROR OpenRouter API error for model meta-llama/llama-3.1-8b-instruct: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
WARNING Model meta-llama/llama-3.1-8b-instruct failed: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}
‚ùå Llama 3.1 8B (Budget): Exception - Failed to generate content with meta-llama/llama-3.1-8b-instruct: Error code: 402 - {'error': {'message': 'Insufficient credits. This account never purchased credits. Make sure your key is on the correct account or org, and if so, purchase more at https://openrouter.ai/settings/credits', 'code': 402}}

======================================================================
  8. Testing Content Generation History
======================================================================
‚ÑπÔ∏è  No content generation history yet (will be created after first generation)

======================================================================
  9. Testing Cost Tracking
======================================================================
‚ÑπÔ∏è  No cost data yet (run some generations first)

======================================================================
  10. Testing Error Handling
======================================================================
ERROR OpenRouter API error for model invalid/model: Error code: 400 - {'error': {'message': 'invalid/model is not a valid model ID', 'code': 400}, 'user_id': 'user_2zdIN52SxmzF3mWMDGmv8MtZkw1'}
WARNING Model invalid/model failed: Error code: 400 - {'error': {'message': 'invalid/model is not a valid model ID', 'code': 400}, 'user_id': 'user_2zdIN52SxmzF3mWMDGmv8MtZkw1'}
‚úÖ Error handling works (exception caught: Exception)

======================================================================
  Test Summary
======================================================================

======================================================================
Results: 5/9 tests passed
======================================================================

‚úÖ PASSED - Config
‚úÖ PASSED - Models
‚ùå FAILED - Simple Gen
‚ùå FAILED - Review Gen
‚ùå FAILED - Comparison Gen
‚ùå FAILED - Different Models
‚úÖ PASSED - History
‚úÖ PASSED - Cost Tracking
‚úÖ PASSED - Error Handling

‚ö†Ô∏è  Some tests failed. Please review the errors above.
   ‚Ä¢ If in mock mode, some failures are expected
   ‚Ä¢ Check your OpenRouter API key if real API tests fail
   ‚Ä¢ See COMPLETE_IMPLEMENTATION_GUIDE.md for troubleshooting
